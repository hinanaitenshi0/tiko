##################################################
### on_actions scripted effect 
##################################################

# ROOT = location(province)
THE_SUW_on_province_religion_converted_scripted_effects = {
	# 在任务效果中set所需的flag
	if = {
		limit = { 
			owner = {  
				has_country_flag = THE_SUW_converte_province_religion_add_1_manpower_flag
				NOT = {
					had_country_flag = {
						flag = THE_SUW_converte_province_religion_add_1_manpower_flag
						days = 10950
					}
				}
			} 
		}
		owner = { add_manpower = 1 }
	}
}


THE_SUW_on_war_won_scripted_effects = {
	if = {
		limit ={
			tag = SUW
			has_country_flag = THE_SUW_The_Beginning_of_Holy_War_one_flag 
			FROM = {
				has_reform = shogunate
			}
		}
		country_event = {
			id = THE_SUW_events.10
			days = 30
		}
	}
	if = {
		limit ={
			tag = SUW
			has_country_flag = THE_SUW_The_Beginning_of_Holy_War_two_flag 
			FROM = {
				has_reform = shogunate
			}
		}
		country_event = {
			id = THE_SUW_events.11
			days = 30
		}
	}
}



THE_SUW_on_province_owner_change_scripted_effects = {
	if = {
		limit = {
			province_id = 1839
			owned_by = SUW
			owner = {
				NOT = { has_country_flag = THE_SUW_hojousouun_flag }
			}
		}
		owner = {
			country_event = {
				id = THE_SUW_events.13
				days = 30
				random = 150
			}
			set_country_flag = THE_SUW_hojousouun_flag
		}
	}
}

THE_SUW_on_four_year_pulse_scripted_effects = {
	random_event = {
		100 = THE_SUW_events.19
	}
}

THE_SUW_on_bi_yearly_pulse_scripted_effects = {
	random_event = {
		100 = THE_SUW_events.20
		100 = THE_SUW_events.21
		100 = THE_SUW_events.22
		100 = THE_SUW_events.23
		100 = THE_SUW_events.24
		100 = THE_SUW_events.25
		100 = THE_SUW_events.26
	}
}

THE_SUW_on_war_won_religion_scripted_effects = {
	if = {
		limit ={
			has_church_aspect = THE_SUW_3_1_aspect 
		}
		export_to_variable = {
     		which  = moneyAvailable
    		value = treasury
			who = FROM
		}
		multiply_variable  = {            
    		which = moneyAvailable
    		value = 0.2
		}
		while = {
			limit = { 
				check_variable = {
					which = moneyAvailable
					value = 1000
				}
			}
			subtract_variable = {
				which = moneyAvailable
				value = 1000
			}
			add_treasury = 1000
		}
		while = {
			limit = { 
				check_variable = {
					which = moneyAvailable
					value = 100
				}
			}
			subtract_variable = {
				which = moneyAvailable
				value = 100
			}
			add_treasury = 100
		}
		while = {
			limit = { 
				check_variable = {
					which = moneyAvailable
					value = 10
				}
			}
			subtract_variable = {
				which = moneyAvailable
				value = 10
			}
			add_treasury = 10
		}
		while = {
			limit = { 
				check_variable = {
					which = moneyAvailable
					value = 1
				}
			}
			subtract_variable = {
				which = moneyAvailable
				value = 1
			}
			add_treasury = 1
		}
	}
}

THE_SUW_on_war_ended_religion_scripted_effects = {
	remove_country_modifier = THE_SUW_fire_country_modifier
	remove_country_modifier = THE_SUW_Difficult_to_know_like_yin_country_modifier
}

THE_SUW_on_battle_unit_religion_scripted_effects = {
	if = {
		limit = {
			has_church_aspect = THE_SUW_3_3_aspect
		}
		ROOT = {
			set_variable = {
				which = land_units_killed_var
				which = land_units_killed
			}
			multiply_variable = {
				which = land_units_killed_var
				value = 0.2
			}
			while = {
				limit = {
					check_variable = {
						which = land_units_killed_var
						value = 1000
					}
				}
				subtract_variable = {
					which = land_units_killed_var
					value = 1000
				}
				add_manpower = 1
			}
			multiply_variable = {
				which = land_units_killed_var
				value = 1000
			}
			while = {
				limit = {
					check_variable = {
						which = land_units_killed_var
						value = 1000
					}
				}
				subtract_variable = {
					which = land_units_killed_var
					value = 1000
				}
				add_manpower = 0.001
			}
		}
	}
}

clr_THE_moriyaseikyou_religion_aspects_buffs = {
	if = {
		limit = { NOT = { has_church_aspect = THE_SUW_2_3_aspect } }
		every_owned_province = {
			remove_province_modifier = THE_SUW_Peace_under_the_miko_province_modifier
		}
	}
}

THE_clear_religious_scholar_modifiers_effect = {
  remove_country_modifier = THE_moriya_scholar_modifier
  remove_country_modifier = THE_kanako_scholar_modifier
  remove_country_modifier = THE_yuuitsu_scholar_modifier
  remove_country_modifier = THE_kamigami_scholar_modifier
  remove_country_modifier = THE_sanae_scholar_modifier
}

on_mercenary_recruited_effect = { #暂时无效的佣兵职业度
	if = {
        limit = {
            FROM = { 
                has_country_flag = hun_no_prof_black_army
            }
            OR = {
                ROOT = { mercenary_company = merc_black_army }
                ROOT = { mercenary_company = merc_black_army_2 }
            }
        }
        FROM = { add_army_professionalism = 0.01 }
    }
	if = {
		limit = {
			FROM = { has_not_free_mercs_trait = yes }
			is_not_free_merc_company = yes
			OR = {
				FROM = { NOT = { has_country_flag = oyo_cavalry_do_not_consume_ap } }
				ROOT = { NOT = { mercenary_company = merc_oyo_cavalry } }
				FROM = { NOT = { has_country_modifier = hsn_turkoman_mercenaries } }
			}
		}
		if = {
			limit = {
				FROM = { 
					OR = {
						has_country_flag = fifty_percent_merc_army_professionalism_cost 
						has_country_modifier = pol_cheap_ap_mercs_modifier
					}
				}
			}
			FROM = { add_army_professionalism = -0.025 }
		}
		else = { 
			FROM = { add_army_professionalism = -0.05 } 
		}
	}
}

THE_SUW_change_religion_scripted_effects = {
	every_country = {
		limit = {
			dominant_religion = THE_moriyaseikyou_religion
		}
		country_event = {
			id = THE_SUW_events.36
		}
	}
}

THE_SUW_change_government_reform_progress = {
	#根据予取好感给改革点
	if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 100 } } change_government_reform_progress = 100 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 90 } } change_government_reform_progress = 90 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 80 } } change_government_reform_progress = 80 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 70 } } change_government_reform_progress = 70 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 60 } } change_government_reform_progress = 60 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 50 } } change_government_reform_progress = 50 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 40 } } change_government_reform_progress = 40 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 30 } } change_government_reform_progress = 30 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 20 } } change_government_reform_progress = 20 }
	else_if = { limit = { estate_loyalty = { estate = estate_burghers loyalty = 10 } } change_government_reform_progress = 10 }
}

#THE_SUW_enable_estate_action = {
#	custom_tooltip = THE_SUW_estate_burgher_action_tt
#	custom_tooltip = estate_action_potential_effect
#	tooltip = {
#		THE_SUW_estate_burghers_action = yes
#	}
#	hidden_effect = {
#		set_country_flag = THE_SUW_estate_burghers_saisennbakokouryuu_flag
#	}
#}

THE_SUW_estate_burghers_action = {
	add_years_of_income = -0.33
	add_country_modifier = {
		name = "THE_SUW_saisennbakokouryuu_country_modiffier"
		duration = 3650
	}
	#add_estate_influence_modifier = {
	#	estate = estate_burghers
	#	desc = EST_VAL_NEW_WORLD_CHARTER
	#	influence = 15
	#	duration = 3650
	#}
}

#地势坤
THE_SUW_has_terrain_scripted_effects = {
	if = {
		limit = {  
			any_owned_province = { has_terrain = glacier }
		}
		custom_tooltip = THE_SUW_has_terrain_glacier
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_glacier_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = farmlands }
		}
		custom_tooltip = THE_SUW_has_terrain_farmlands
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_farmlands_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = forest }
		}
		custom_tooltip = THE_SUW_has_terrain_forest
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_forest_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = hills }
		}
		custom_tooltip = THE_SUW_has_terrain_hills
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_hills_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = woods }
		}
		custom_tooltip = THE_SUW_has_terrain_woods
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_woods_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = mountain }
		}
		custom_tooltip = THE_SUW_has_terrain_mountain
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_mountain_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = grasslands }
		}
		custom_tooltip = THE_SUW_has_terrain_grasslands
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_grasslands_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = jungle }
		}
		custom_tooltip = THE_SUW_has_terrain_jungle
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_jungle_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = marsh }
		}
		custom_tooltip = THE_SUW_has_terrain_marsh
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_marsh_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = desert }
		}
		custom_tooltip = THE_SUW_has_terrain_desert
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_desert_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = coastal_desert }
		}
		custom_tooltip = THE_SUW_has_terrain_coastal_desert
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_coastal_desert_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = coastline }
		}
		custom_tooltip = THE_SUW_has_terrain_coastline
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_coastline_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = drylands }
		}
		custom_tooltip = THE_SUW_has_terrain_drylands
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_drylands_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = highlands }
		}
		custom_tooltip = THE_SUW_has_terrain_highlands
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_highlands_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = savannah }
		}
		custom_tooltip = THE_SUW_has_terrain_savannah
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_savannah_country_modiffier
				duration = -1
			}
		}
		
		
	}
	if = {
		limit = {  
			any_owned_province = { has_terrain = steppe }
		}
		custom_tooltip = THE_SUW_has_terrain_steppe
		hidden_effect = {
			add_country_modifier = {
				name = THE_SUW_defensiveness_steppe_country_modiffier
				duration = -1
			}
		}
		
		
	}
}

##################################################
### not on_actions scripted effect 
##################################################